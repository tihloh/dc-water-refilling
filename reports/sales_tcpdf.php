<?php 	 $day=$_GET["day"]??""; $month=$_GET["month"]??""; $year=$_GET["year"]??$current_year; 	 class MYPDF extends TCPDF{ 	function BasicTable(){ 		Global $mysqli, $day, $month, $year;	 		$d=$day!=""?" and day(time)='$day'":""; 		$m=$month!=""?" and month(time)='$month'":"";  		$this->SetFont('helvetica','B',11); 		$this->Cell(190,10,"DC Water Refilling Station",0,0,'C'); 		$this->Ln(5); 		$this->Cell(190,10,"SALES REPORT",0,0,'C'); 		$this->Ln(5); 		$this->Cell(190,10,"$year ".($month!==""?datetoformat("2021-$month-01","F"):"")." $day",0,0,'C'); 		$this->Ln();  		$this->SetFont('helvetica','B',9); 		$this->Cell(100,6,"Order per Customer",0,0,""); 		$this->Ln(); 		$this->Cell(45,6,"Customer","LTR",0,""); 		$this->Cell(50,6,"Address","LTR",0,""); 		$this->Cell(65,6,"Order","LTR",0,""); 		$this->Cell(30,6,"Amount","LTR",0,"C"); 		$this->Ln(); 		 		$q="SELECT *, sum(charge) scharge FROM tblorders o INNER JOIN 			(SELECT GROUP_CONCAT(' ',oi.qty,' ',item) details, orderid FROM tblorder_items oi INNER JOIN tblitems i ON oi.itemid=i.id WHERE fromsched=0 GROUP BY orderid) oi ON oi.orderid=o.id 			WHERE cancelled=0 and year(time)='$year' $m $d 			GROUP BY o.id"; 		$result = $mysqli->query($q); 		$this->SetFont('helvetica','',9); 		$no=0; $total=0; 		while ($row = $result->fetch_assoc()){ 			$this->Cell(45,6,$row['customer'],1,0,""); 			$this->Cell(50,6,$row['addr'],1,0,""); 			$this->Cell(65,6,shorttext($row['details'],40),1,0,""); 			$this->Cell(30,6,formatnum($row['scharge']),1,0,"R"); 			$this->Ln(); 			$total +=$row['scharge']; 		} 		$result->free(); 		 		$this->SetFont('helvetica','B',9); 		$this->Cell(160,6,"TOTAL",0,0,"R"); 		$this->Cell(30,6,formatnum($total),1,0,"R"); 		$this->Ln(); 	} 	function BasicTable2(){ 		Global $mysqli, $day, $month, $year;	 		$d=$day!=""?" and day(time)='$day'":""; 		$m=$month!=""?" and month(time)='$month'":"";  		$this->Ln(); 		$this->SetFont('helvetica','B',9); 		$this->Cell(100,6,"Order per Item",0,0,""); 		$this->Ln(); 		$this->Cell(100,6,"Item","LTR",0,""); 		$this->Cell(30,6,"Price","LTR",0,"C"); 		$this->Cell(30,6,"Qty","LTR",0,"C"); 		$this->Cell(30,6,"Total","LTR",0,"C"); 		$this->Ln(); 		 		$q="SELECT *, sum(qty) sqty, sum(price) sprice FROM tblorders o INNER JOIN tblorder_items oi ON o.id=oi.orderid INNER JOIN tblitems i ON oi.itemid=i.id 			WHERE cancelled=0 and year(time)='$year' $m $d 			GROUP BY i.id"; 		$result = $mysqli->query($q); 		$this->SetFont('helvetica','',9); 		$no=0; $total=0; 		while ($row = $result->fetch_assoc()){ 			$t=$row['price']*$row['sqty']; 			$this->Cell(100,6,$row['item'],1,0,""); 			$this->Cell(30,6,formatnum($row['price']),1,0,"C"); 			$this->Cell(30,6,$row['sqty'],1,0,"C"); 			$this->Cell(30,6,formatnum($t),1,0,"R"); 			$this->Ln(); 			$total +=$t; 		} 		$result->free(); 		 		$this->SetFont('helvetica','B',9); 		$this->Cell(160,6,"TOTAL",0,0,"R"); 		$this->Cell(30,6,formatnum($total),1,0,"R"); 		$this->Ln(); 	} 	function BasicTable3(){ 		Global $mysqli, $day, $month, $year;	 		$d=$day!=""?" and day(time)='$day'":""; 		$m=$month!=""?" and month(time)='$month'":"";  		$this->Ln(); 		$this->SetFont('helvetica','B',9); 		$this->Cell(100,6,"Order per Area",0,0,""); 		$this->Ln(); 		$this->Cell(50,6,"Area","LTR",0,""); 		$this->Cell(110,6,"Items","LTR",0,"C"); 		$this->Cell(30,6,"Total","LTR",0,"C"); 		$this->Ln(); 		 		$q="SELECT *, sum(charge) scharge FROM tblorders o INNER JOIN 			(SELECT GROUP_CONCAT(' ',oi.qty,' ',item) details, orderid FROM tblorder_items oi INNER JOIN tblitems i ON oi.itemid=i.id WHERE fromsched=0 GROUP BY orderid) oi ON oi.orderid=o.id 			WHERE cancelled=0 and year(time)='$year' $m $d 			GROUP BY o.addr"; 		$result = $mysqli->query($q); 		$this->SetFont('helvetica','',9); 		$no=0; $total=0; 		while ($row = $result->fetch_assoc()){ 			$this->Cell(50,6,$row['addr'],1,0,""); 			$this->Cell(110,6,shorttext($row['details'],68),1,0,""); 			$this->Cell(30,6,formatnum($row['scharge']),1,0,"R"); 			$this->Ln(); 			$total +=$row['scharge']; 		}  		$result->free(); 		 		$this->SetFont('helvetica','B',9); 		$this->Cell(160,6,"TOTAL",0,0,"R"); 		$this->Cell(30,6,formatnum($total),1,0,"R"); 		$this->Ln(); 	} }  $pdf = new MYPDF("P", PDF_UNIT, "LONG", true, 'UTF-8', false); $pdf->setPrintHeader(false); $pdf->setPrintFooter(false); $pdf->SetAutoPageBreak(true,7.8); $pdf->SetDisplayMode('real'); $pdf->SetMargins(PDF_MARGIN_LEFT, 10, PDF_MARGIN_RIGHT); $pdf->SetFont('helvetica','',11); $pdf->SetTitle('Sales Report'); $pdf->AddPage('p'); $pdf->BasicTable(); $pdf->BasicTable2(); $pdf->BasicTable3(); $pdf->Output(); ?>